"use strict";const e=require("./base/Exchange"),{ExchangeError:t}=require("./base/errors"),{ROUND:i}=require("./base/functions/number");module.exports=class extends e{describe(){return this.deepExtend(super.describe(),{id:"flowbtc",name:"flowBTC",countries:"BR",version:"v1",rateLimit:1e3,has:{CORS:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/28162465-cd815d4c-67cf-11e7-8e57-438bea0523a2.jpg",api:"https://api.flowbtc.com:8405/ajax",www:"https://trader.flowbtc.com",doc:"http://www.flowbtc.com.br/api/"},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},api:{public:{post:["GetTicker","GetTrades","GetTradesByDate","GetOrderBook","GetProductPairs","GetProducts"]},private:{post:["CreateAccount","GetUserInfo","SetUserInfo","GetAccountInfo","GetAccountTrades","GetDepositAddresses","Withdraw","CreateOrder","ModifyOrder","CancelOrder","CancelAllOrders","GetAccountOpenOrders","GetOrderFee"]}},fees:{trading:{tierBased:!1,percentage:!0,maker:.0035,taker:.0035}}})}async fetchMarkets(){let e=(await this.publicPostGetProductPairs()).productPairs,t={};for(let i=0;i<e.length;i++){let s=e[i],r=s.name,a=s.product1Label,o=s.product2Label,d={amount:this.safeInteger(s,"product1DecimalPlaces"),price:this.safeInteger(s,"product2DecimalPlaces")},c=a+"/"+o;t[c]={id:r,symbol:c,base:a,quote:o,precision:d,limits:{amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s}}return t}async fetchBalance(e={}){await this.loadMarkets();let t=await this.privatePostGetAccountInfo(),i=t.currencies,s={info:t};for(let e=0;e<i.length;e++){let t=i[e],r=t.name,a={free:t.balance,used:t.hold,total:0};a.total=this.sum(a.free,a.used),s[r]=a}return this.parseBalance(s)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();let s=this.market(e),r=await this.publicPostGetOrderBook(this.extend({productPair:s.id},i));return this.parseOrderBook(r,void 0,"bids","asks","px","qty")}async fetchTicker(e,t={}){await this.loadMarkets();let i=this.market(e),s=await this.publicPostGetTicker(this.extend({productPair:i.id},t)),r=this.milliseconds(),a=this.safeFloat(s,"last");return{symbol:e,timestamp:r,datetime:this.iso8601(r),high:this.safeFloat(s,"high"),low:this.safeFloat(s,"low"),bid:this.safeFloat(s,"bid"),bidVolume:void 0,ask:this.safeFloat(s,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeFloat(s,"volume24hr"),quoteVolume:this.safeFloat(s,"volume24hrProduct2"),info:s}}parseTrade(e,t){let i=1e3*e.unixtime,s=0===e.incomingOrderSide?"buy":"sell";return{info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,id:e.tid.toString(),order:void 0,type:void 0,side:s,price:e.px,amount:e.qty}}async fetchTrades(e,t,i,s={}){await this.loadMarkets();let r=this.market(e),a=await this.publicPostGetTrades(this.extend({ins:r.id,startIndex:-1},s));return this.parseTrades(a.trades,r,t,i)}priceToPrecision(e,t){return this.decimalToPrecision(t,i,this.markets[e].precision.price,this.precisionMode)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();let o="market"===t?1:0,d={ins:this.marketId(e),side:i,orderType:o,qty:s,px:this.priceToPrecision(e,r)},c=await this.privatePostCreateOrder(this.extend(d,a));return{info:c,id:c.serverOrderId}}async cancelOrder(e,i,s={}){if(await this.loadMarkets(),"ins"in s)return await this.privatePostCancelOrder(this.extend({serverOrderId:e},s));throw new t(this.id+" requires `ins` symbol parameter for cancelling an order")}sign(e,t="public",i="GET",s={},r,a){let o=this.urls.api+"/"+this.version+"/"+e;if("public"===t)Object.keys(s).length&&(a=this.json(s));else{this.checkRequiredCredentials();let e=this.nonce(),t=e.toString()+this.uid+this.apiKey,i=this.hmac(this.encode(t),this.encode(this.secret));a=this.json(this.extend({apiKey:this.apiKey,apiNonce:e,apiSig:i.toUpperCase()},s)),r={"Content-Type":"application/json"}}return{url:o,method:i,body:a,headers:r}}async request(e,i="public",s="GET",r={},a,o){let d=await this.fetch2(e,i,s,r,a,o);if("isAccepted"in d&&d.isAccepted)return d;throw new t(this.id+" "+this.json(d))}};
//# sourceMappingURL=flowbtc.js.map