"use strict";const e=require("./base/Exchange"),{InsufficientFunds:t,OrderNotFound:s}=require("./base/errors");module.exports=class extends e{describe(){return this.deepExtend(super.describe(),{id:"tidebit",name:"TideBit",countries:"HK",rateLimit:1e3,version:"v2",has:{fetchDepositAddress:!0,CORS:!0,fetchTickers:!0,fetchOHLCV:!0,withdraw:!0},timeframes:{"1m":"1","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","12h":"720","1d":"1440","3d":"4320","1w":"10080"},urls:{logo:"https://user-images.githubusercontent.com/1294454/39034921-e3acf016-4480-11e8-9945-a6086a1082fe.jpg",api:"https://www.tidebit.com/api",www:"https://www.tidebit.com",doc:"https://www.tidebit.com/documents/api_v2"},api:{public:{get:["v2/markets","v2/tickers","v2/tickers/{market}","v2/trades","v2/trades/{market}","v2/order_book","v2/order","v2/k_with_pending_trades","v2/k","v2/depth"],post:[]},private:{get:["v2/deposits","v2/deposit_address","v2/deposit","v2/members/me","v2/addresses/{address}"],post:["v2/order/delete","v2/order","v2/order/multi","v2/order/clear"]}},fees:{trading:{tierBased:!1,percentage:!0,maker:.002,taker:.002},funding:{tierBased:!1,percentage:!0,withdraw:{}}},exceptions:{2002:t,2003:s}})}async fetchDepositAddress(e,t={}){await this.loadMarkets();let s=this.currency(e),i=await this.privateGetV2DepositAddress(this.extend({currency:s.id},t));if("success"in i&&i.success){let t=this.safeString(i,"address"),s=this.safeString(i,"addressTag");return{currency:e,address:this.checkAddress(t),tag:s,status:"ok",info:i}}}async fetchMarkets(){let e=await this.publicGetV2Markets(),t=[];for(let s=0;s<e.length;s++){let i=e[s],a=i.id,r=i.name,[o,d]=r.split("/"),h=this.commonCurrencyCode(o),c=this.commonCurrencyCode(d);t.push({id:a,symbol:r,base:h,quote:c,baseId:o,quoteId:d,info:i})}return t}async fetchBalance(e={}){await this.loadMarkets();let t=(await this.privateGetV2Deposits()).accounts,s={info:t};for(let e=0;e<t.length;e++){let i=t[e],a=i.currency,r=a.toUpperCase();a in this.currencies_by_id&&(r=this.currencies_by_id[a].code);let o={free:parseFloat(i.balance),used:parseFloat(i.locked),total:0};o.total=this.sum(o.free,o.used),s[r]=o}return this.parseBalance(s)}async fetchOrderBook(e,t,s={}){await this.loadMarkets();let i=this.market(e),a={market:i.id};void 0===t&&(a.limit=t),a.market=i.id;let r=await this.publicGetV2Depth(this.extend(a,s)),o=1e3*r.timestamp;return this.parseOrderBook(r,o)}parseTicker(e,t){let s=1e3*e.at;e=e.ticker;let i=void 0;void 0!==t&&(i=t.symbol);let a=this.safeFloat(e,"last");return{symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeFloat(e,"high"),low:this.safeFloat(e,"low"),bid:this.safeFloat(e,"buy"),ask:this.safeFloat(e,"sell"),bidVolume:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,change:void 0,percentage:void 0,previousClose:void 0,average:void 0,baseVolume:this.safeFloat(e,"vol"),quoteVolume:void 0,info:e}}async fetchTickers(e,t={}){await this.loadMarkets();let s=await this.publicGetV2Tickers(t),i=Object.keys(s),a={};for(let e=0;e<i.length;e++){let t=i[e],r=void 0,o=t;if(t in this.markets_by_id)o=(r=this.markets_by_id[t]).symbol;else{let e=t.slice(0,3),s=t.slice(3,6);e=e.toUpperCase(),s=s.toUpperCase(),o=(e=this.commonCurrencyCode(e))+"/"+(s=this.commonCurrencyCode(s))}let d=s[t];a[o]=this.parseTicker(d,r)}return a}async fetchTicker(e,t={}){await this.loadMarkets();let s=this.market(e),i=await this.publicGetV2TickersMarket(this.extend({market:s.id},t));return this.parseTicker(i,s)}parseTrade(e,t){let s=this.parse8601(e.created_at);return{id:e.id.toString(),timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:void 0,side:void 0,price:this.safeFloat(e,"price"),amount:this.safeFloat(e,"volume"),cost:this.safeFloat(e,"funds"),info:e}}async fetchTrades(e,t,s,i={}){await this.loadMarkets();let a=this.market(e),r=await this.publicGetV2Trades(this.extend({market:a.id},i));return this.parseTrades(r,a,t,s)}parseOHLCV(e,t,s="1m",i,a){return[1e3*e[0],e[1],e[2],e[3],e[4],e[5]]}async fetchOHLCV(e,t="1m",s,i,a={}){await this.loadMarkets();let r=this.market(e);i||(i=30);let o={market:r.id,period:this.timeframes[t],limit:i};o.timestamp=void 0!==s?s:18e5;let d=await this.publicGetV2K(this.extend(o,a));return this.parseOHLCVs(d,r,t,s,i)}parseOrder(e,t){let s=void 0;if(t)s=t.symbol;else{let t=e.market;s=this.markets_by_id[t].symbol}let i=this.parse8601(e.created_at),a=e.state,r=void 0;return"done"===a?r="closed":"wait"===a?r="open":"cancel"===a&&(r="canceled"),{id:e.id.toString(),timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:r,symbol:s,type:e.ord_type,side:e.side,price:this.safeFloat(e,"price"),amount:this.safeFloat(e,"volume"),filled:this.safeFloat(e,"executed_volume"),remaining:this.safeFloat(e,"remaining_volume"),trades:void 0,fee:void 0,info:e}}async createOrder(e,t,s,i,a,r={}){await this.loadMarkets();let o={market:this.marketId(e),side:s,volume:i.toString(),ord_type:t};"limit"===t&&(o.price=a.toString());let d=await this.privatePostV2Order(this.extend(o,r)),h=this.markets_by_id[d.market];return this.parseOrder(d,h)}async cancelOrder(e,t,i={}){await this.loadMarkets();let a=await this.privatePostV2OrderDelete({id:e}),r=this.parseOrder(a),o=r.status;if("closed"===o||"canceled"===o)throw new s(this.id+" "+this.json(r));return r}async withdraw(e,t,s,i,a={}){return this.checkAddress(s),await this.loadMarkets(),{info:await this.privatePostWithdraw(this.extend({currency:e.toLowerCase(),sum:t,address:s},a)),id:void 0}}nonce(){return this.milliseconds()}encodeParams(e){return this.urlencode(this.keysort(e))}sign(e,t="public",s="GET",i={},a,r){let o=this.implodeParams(e,i)+".json",d=this.omit(i,this.extractParams(e)),h=this.urls.api+"/"+o;if("public"===t)Object.keys(d).length&&(h+="?"+this.urlencode(d));else{this.checkRequiredCredentials();let e=this.nonce().toString(),t=this.urlencode(this.extend({access_key:this.apiKey,tonce:e},i)),d=s+"|"+o+"|"+t,c=t+"&signature="+this.hmac(this.encode(d),this.encode(this.secret));"GET"===s?h+="?"+c:(r=c,a={"Content-Type":"application/x-www-form-urlencoded"})}return{url:h,method:s,body:r,headers:a}}handleErrors(e,t,s,i,a,r){if(400===e){const e=JSON.parse(r),t=this.safeValue(e,"error"),s=this.safeString(t,"code"),i=this.id+" "+this.json(e),a=this.exceptions;if(s in a)throw new a[s](i)}}};
//# sourceMappingURL=tidebit.js.map