"use strict";const e=require("./base/Exchange"),{ExchangeError:t,InsufficientFunds:a,OrderNotFound:i,InvalidOrder:s,AuthenticationError:r}=require("./base/errors");module.exports=class extends e{describe(){return this.deepExtend(super.describe(),{id:"coinex",name:"CoinEx",version:"v1",countries:"CN",rateLimit:1e3,has:{fetchTickers:!0,fetchOHLCV:!0,fetchOrder:!0,fetchOpenOrders:!0,fetchClosedOrders:!0,fetchMyTrades:!0},timeframes:{"1m":"1min","3m":"3min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","2h":"2hour","4h":"4hour","6h":"6hour","12h":"12hour","1d":"1day","3d":"3day","1w":"1week"},urls:{logo:"https://user-images.githubusercontent.com/1294454/38046312-0b450aac-32c8-11e8-99ab-bc6b136b6cc7.jpg",api:{public:"https://api.coinex.com",private:"https://api.coinex.com",web:"https://www.coinex.com"},www:"https://www.coinex.com",doc:"https://github.com/coinexcom/coinex_exchange_api/wiki",fees:"https://www.coinex.com/fees"},api:{web:{get:["res/market"]},public:{get:["market/list","market/ticker","market/ticker/all","market/depth","market/deals","market/kline"]},private:{get:["balance","order","order/pending","order/finished","order/finished/{id}","order/user/deals"],post:["order/limit","order/market"],delete:["order/pending"]}},fees:{trading:{maker:0,taker:.001},funding:{withdraw:{BCH:0,BTC:.001,LTC:.001,ETH:.001,ZEC:1e-4,DASH:1e-4}}},limits:{amount:{min:.001,max:void 0}},precision:{amount:8,price:8}})}async fetchMarkets(){let e=(await this.webGetResMarket()).data.market_info,t=[],a=Object.keys(e);for(let i=0;i<a.length;i++){let s=e[a[i]],r=s.market,o=s.buy_asset_type,d=s.sell_asset_type,h=this.commonCurrencyCode(d),l=this.commonCurrencyCode(o),n=h+"/"+l,c={amount:s.sell_asset_type_places,price:s.buy_asset_type_places},m=s.merge.length;t.push({id:r,symbol:n,base:h,quote:l,baseId:d,quoteId:o,active:!0,taker:this.safeFloat(s,"taker_fee_rate"),maker:this.safeFloat(s,"maker_fee_rate"),info:s,precision:c,limits:{amount:{min:this.safeFloat(s,"least_amount"),max:void 0},price:{min:parseFloat(s.merge[m-1]),max:void 0}}})}return t}parseTicker(e,t){let a=e.date,i=t.symbol;e=e.ticker;let s=this.safeFloat(e,"last");return{symbol:i,timestamp:a,datetime:this.iso8601(a),high:this.safeFloat(e,"high"),low:this.safeFloat(e,"low"),bid:this.safeFloat(e,"buy"),bidVolume:void 0,ask:this.safeFloat(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeFloat(e,"vol"),quoteVolume:void 0,info:e}}async fetchTicker(e,t={}){await this.loadMarkets();let a=this.market(e),i=await this.publicGetMarketTicker(this.extend({market:a.id},t));return this.parseTicker(i.data,a)}async fetchTickers(e,t={}){await this.loadMarkets();let a=(await this.publicGetMarketTickerAll(t)).data,i=a.date,s=a.ticker,r=Object.keys(s),o={};for(let e=0;e<r.length;e++){let t=r[e],a=this.markets_by_id[t],d=a.symbol,h={date:i,ticker:s[t]};o[d]=this.parseTicker(h,a)}return o}async fetchOrderBook(e,t={}){await this.loadMarkets();let a=await this.publicGetMarketDepth(this.extend({market:this.marketId(e),merge:"0.00000001"},t));return this.parseOrderBook(a.data)}parseTrade(e,t){let a=this.safeInteger(e,"create_time"),i=this.safeString(e,"id"),s=this.safeString(e,"id");a?i=void 0:(a=e.date,s=void 0),a*=1e3;let r=this.safeFloat(e,"price"),o=this.safeFloat(e,"amount"),d=t.symbol,h=this.safeFloat(e,"deal_money");h||(h=parseFloat(this.costToPrecision(d,r*o)));let l=this.safeFloat(e,"fee");return{info:e,timestamp:a,datetime:this.iso8601(a),symbol:d,id:i,order:s,type:"limit",side:e.type,price:r,amount:o,cost:h,fee:l}}async fetchTrades(e,t,a,i={}){await this.loadMarkets();let s=this.market(e),r=await this.publicGetMarketDeals(this.extend({market:s.id},i));return this.parseTrades(r.data,s,t,a)}parseOHLCV(e,t,a="5m",i,s){return[e[0],parseFloat(e[1]),parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[2]),parseFloat(e[5])]}async fetchOHLCV(e,t="5m",a,i,s={}){await this.loadMarkets();let r=this.market(e),o=await this.publicGetMarketKline(this.extend({market:r.id,type:this.timeframes[t]},s));return this.parseOHLCVs(o.data,r,t,a,i)}async fetchBalance(e={}){await this.loadMarkets();let t=await this.privateGetBalance(e),a={info:t},i=t.data,s=Object.keys(i);for(let e=0;e<s.length;e++){let t=s[e],r=i[t],o=this.commonCurrencyCode(t),d={free:parseFloat(r.available),used:parseFloat(r.frozen),total:0};d.total=this.sum(d.free,d.used),a[o]=d}return this.parseBalance(a)}parseOrder(e,t){let a=1e3*this.safeInteger(e,"create_time"),i=this.safeFloat(e,"price"),s=this.safeFloat(e,"deal_money"),r=this.safeFloat(e,"amount"),o=this.safeFloat(e,"deal_amount"),d=t.symbol,h=this.amountToPrecision(d,r-o),l=e.status;return l="done"===l?"closed":"open",{id:this.safeString(e,"id"),datetime:this.iso8601(a),timestamp:a,lastTradeTimestamp:void 0,status:l,symbol:d,type:e.order_type,side:e.type,price:i,cost:s,amount:r,filled:o,remaining:h,trades:void 0,fee:{currency:t.quote,cost:this.safeFloat(e,"deal_fee")},info:e}}async createOrder(e,t,a,i,s,r={}){await this.loadMarkets();let o="privatePostOrder"+this.capitalize(t),d=this.market(e);i=parseFloat(i);let h={market:d.id,amount:this.amountToPrecision(e,i),type:a};"limit"===t&&(s=parseFloat(s),h.price=this.priceToPrecision(e,s));let l=await this[o](this.extend(h,r)),n=this.parseOrder(l.data,d),c=n.id;return this.orders[c]=n,n}async cancelOrder(e,t,a={}){await this.loadMarkets();let i=this.market(t),s=await this.privateDeleteOrderPending(this.extend({id:e,market:i.id},a));return this.parseOrder(s.data,i)}async fetchOrder(e,t,a={}){await this.loadMarkets();let i=this.market(t),s=await this.privateGetOrder(this.extend({id:e,market:i.id},a));return this.parseOrder(s.data,i)}async fetchOpenOrders(e,t,a,i={}){await this.loadMarkets();let s=this.market(e),r={market:s.id};a&&(r.limit=a);let o=await this.privateGetOrderPending(this.extend(r,i));return this.parseOrders(o.data.data,s)}async fetchClosedOrders(e,t,a,i={}){await this.loadMarkets();let s=this.market(e),r={market:s.id};a&&(r.limit=a);let o=await this.privateGetOrderFinished(this.extend(r,i));return this.parseOrders(o.data.data,s)}async fetchMyTrades(e,t,a,i={}){await this.loadMarkets();let s=this.market(e),r=await this.privateGetOrderUserDeals(this.extend({market:s.id,page:1,limit:100},i));return this.parseTrades(r.data.data,s,t,a)}nonce(){return this.milliseconds()}sign(e,t="public",a="GET",i={},s,r){e=this.implodeParams(e,i);let o=this.urls.api[t]+"/"+this.version+"/"+e,d=this.omit(i,this.extractParams(e));if("public"===t)Object.keys(d).length&&(o+="?"+this.urlencode(d));else if("web"===t)o=this.urls.api[t]+"/"+e,Object.keys(d).length&&(o+="?"+this.urlencode(d));else{this.checkRequiredCredentials();let e=this.nonce();d=this.extend({access_id:this.apiKey,tonce:e.toString()},d),d=this.keysort(d);let t=this.urlencode(d);s={Authorization:this.hash(this.encode(t+"&secret_key="+this.secret)).toUpperCase(),"Content-Type":"application/json"},"GET"===a||"DELETE"===a?o+="?"+t:r=this.json(d)}return{url:o,method:a,body:r,headers:s}}async request(e,o="public",d="GET",h={},l,n){let c=await this.fetch2(e,o,d,h,l,n),m=this.safeString(c,"code"),p=this.safeValue(c,"data");if("0"!==m||!p){let e={24:r,25:r,107:a,600:i,601:s,602:s,606:s};throw new(this.safeValue(e,m,t))(c.message)}return c}};
//# sourceMappingURL=coinex.js.map