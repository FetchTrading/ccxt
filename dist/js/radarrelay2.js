"use strict";const{flatten:e}=require("lodash"),{assetDataUtils:t}=require("0x.js"),{BigNumber:r}=require("@0xproject/utils"),{rateUtils:s,orderParsingUtils:o}=require("@0xproject/order-utils"),a=require("./base/Exchange"),i=require("./base/TokenInfo");module.exports=class n extends a{describe(){return this.deepExtend(super.describe(),{id:"radarrelay2",name:"Radar Relay - 0x V2",countries:"USA",version:void 0,userAgent:void 0,rateLimit:500,urls:{logo:"https://radarrelay.com/img/radar-logo-beta.svg",api:"https://api.radarrelay.com/0x/v2",www:"https://radarrelay.com",doc:["https://radarrelay.com/standard-relayer-api/"]},has:{createOrder:!1,createMarketOrder:!1,createLimitOrder:!1,fetchBalance:!1,fetchCurrencies:!1,fetchL2OrderBook:!1,fetchMarkets:!0,fetchOrderBook:!0,fetchTicker:!1,fetchTrades:!1,privateAPI:!1},api:{public:{get:["asset_pairs","orderbook"]}}})}static decodeTokenInfo(e){const r=t.decodeAssetDataOrThrow(e),{tokenAddress:s}=r;return i.getFromAddress(s)}static encodeTokenInfo(e){const r=i.getFromSymbol(e);return r?t.encodeERC20AssetData(r.address):null}sign(e,t="public",r="GET",s={},o,a){const i=this.url(e,s);return{url:this.urls.api+"/"+i,method:r,body:a,headers:o}}async fetchOrderBook(e,t,a={}){const[i,d]=e.split("/"),c=n.encodeTokenInfo(i),u=n.encodeTokenInfo(d),l=await this.publicGetOrderbook({baseAssetData:c,quoteAssetData:u}),m=new r(1),{bids:p,asks:h}=l,b=p.records.map(t=>{const a=o.convertOrderStringFieldsToBigNumber(t.order),i=s.getFeeAdjustedRateOfFeeOrder(a),n=this.markets[e].info.quoteInfo.precision,d=new r("10").pow(n),c=a.makerAssetAmount.div(d);return[m.div(i).toNumber(),c.toNumber(),a]}),f=h.records.map(t=>{const a=o.convertOrderStringFieldsToBigNumber(t.order),i=s.getFeeAdjustedRateOfFeeOrder(a),n=this.markets[e].info.baseInfo.precision,d=new r("10").pow(n),c=a.makerAssetAmount.div(d);return[i.toNumber(),c.toNumber(),a]}),k=new Date;return{timestamp:k.getTime(),datetime:k.toISOString(),nonce:void 0,bids:b,asks:f}}async fetchMarkets(){const t=await this.publicGetAssetPairs(),{total:r,perPage:s}=t,o=[],a=Math.ceil(r/s);for(let e=2;e<=a;e++)o.push(this.publicGetAssetPairs({page:e}));const i=await Promise.all(o);i.push(t);const d=e(i.map(e=>e.records)),c=[];for(let e=0,t=d.length;e<t;e++){const t=d[e],{assetDataA:r,assetDataB:s}=t,o=n.decodeTokenInfo(r.assetData),a=n.decodeTokenInfo(s.assetData);if(o&&a){const e=o.symbol,t=a.symbol,i=`${e}/${t}`;c.push({id:i,symbol:i,base:e,quote:t,active:!0,info:{baseInfo:r,quoteInfo:s}});const n=`${t}/${e}`;c.push({id:n,symbol:n,base:t,quote:e,active:!0,info:{baseInfo:s,quoteInfo:r}})}}return this._markets_only=c,c}};
//# sourceMappingURL=radarrelay.js.map