"use strict";const e=require("./base/Exchange"),{ExchangeError:t}=require("./base/errors");module.exports=class extends e{describe(){return this.deepExtend(super.describe(),{id:"virwox",name:"VirWoX",countries:["AT","EU"],rateLimit:1e3,has:{CORS:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766894-6da9d360-5eea-11e7-90aa-41f2711b7405.jpg",api:{public:"http://api.virwox.com/api/json.php",private:"https://www.virwox.com/api/trading.php"},www:"https://www.virwox.com",doc:"https://www.virwox.com/developers.php"},requiredCredentials:{apiKey:!0,secret:!1,login:!0,password:!0},api:{public:{get:["getInstruments","getBestPrices","getMarketDepth","estimateMarketOrder","getTradedPriceVolume","getRawTradeData","getStatistics","getTerminalList","getGridList","getGridStatistics"],post:["getInstruments","getBestPrices","getMarketDepth","estimateMarketOrder","getTradedPriceVolume","getRawTradeData","getStatistics","getTerminalList","getGridList","getGridStatistics"]},private:{get:["cancelOrder","getBalances","getCommissionDiscount","getOrders","getTransactions","placeOrder"],post:["cancelOrder","getBalances","getCommissionDiscount","getOrders","getTransactions","placeOrder"]}}})}async fetchMarkets(){let e=await this.publicGetGetInstruments(),t=Object.keys(e.result),s=[];for(let i=0;i<t.length;i++){let r=e.result[t[i]],a=r.instrumentID,o=r.symbol,l=r.longCurrency,n=r.shortCurrency;s.push({id:a,symbol:o,base:l,quote:n,info:r})}return s}async fetchBalance(e={}){await this.loadMarkets();let t=(await this.privatePostGetBalances()).result.accountList,s={info:t};for(let e=0;e<t.length;e++){let i=t[e],r=i.currency,a=i.balance,o={free:a,used:0,total:a};s[r]=o}return this.parseBalance(s)}async fetchMarketPrice(e,t={}){await this.loadMarkets();let s=(await this.publicPostGetBestPrices(this.extend({symbols:[e]},t))).result;return{bid:this.safeFloat(s[0],"bestBuyPrice"),ask:this.safeFloat(s[0],"bestSellPrice")}}async fetchOrderBook(e,t,s={}){await this.loadMarkets();let i={symbols:[e]};void 0!==t&&(i.buyDepth=t,i.sellDepth=t);let r=(await this.publicPostGetMarketDepth(this.extend(i,s))).result[0];return this.parseOrderBook(r,void 0,"buy","sell","price","volume")}async fetchTicker(e,t={}){await this.loadMarkets();let s=this.milliseconds(),i=s-864e5,r=(await this.publicGetGetTradedPriceVolume(this.extend({instrument:e,endDate:this.ymdhms(s),startDate:this.ymdhms(i),HLOC:1},t))).result.priceVolumeList,a=Object.keys(r),o=r[a[a.length-1]],l=this.milliseconds(),n=this.safeFloat(o,"close");return{symbol:e,timestamp:l,datetime:this.iso8601(l),high:this.safeFloat(o,"high"),low:this.safeFloat(o,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeFloat(o,"open"),close:n,last:n,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeFloat(o,"longVolume"),quoteVolume:this.safeFloat(o,"shortVolume"),info:o}}parseTrade(e,t){let s=1e3*this.safeInteger(e,"time");return{id:e.tid,timestamp:s,datetime:this.iso8601(s),order:void 0,symbol:t,type:void 0,side:void 0,price:this.safeFloat(e,"price"),amount:this.safeFloat(e,"vol"),fee:void 0,info:e}}async fetchTrades(e,t,s,i={}){await this.loadMarkets();let r=this.market(e),a=(await this.publicGetGetRawTradeData(this.extend({instrument:e,timespan:3600},i))).result.data;return this.parseTrades(a,r)}async createOrder(e,t,s,i,r,a={}){await this.loadMarkets();let o={instrument:this.market(e).symbol,orderType:s.toUpperCase(),amount:i};"limit"===t&&(o.price=r);let l=await this.privatePostPlaceOrder(this.extend(o,a));return{info:l,id:l.result.orderID.toString()}}async cancelOrder(e,t,s={}){return await this.privatePostCancelOrder(this.extend({orderID:e},s))}sign(e,t="public",s="GET",i={},r,a){let o=this.urls.api[t],l={};"private"===t&&(this.checkRequiredCredentials(),l.key=this.apiKey,l.user=this.login,l.pass=this.password);let n=this.nonce();return"GET"===s?o+="?"+this.urlencode(this.extend({method:e,id:n},l,i)):(r={"Content-Type":"application/json"},a=this.json({method:e,params:this.extend(l,i),id:n})),{url:o,method:s,body:a,headers:r}}handleErrors(e,s,i,r,a,o){if(200===e){if("{"!==o[0]&&"["!==o[0])throw new t(this.id+" returned a non-JSON reply: "+o);{let e=JSON.parse(o);if(!("result"in e))throw new t(this.id+" malformed response: no result in response: "+o);{let s=e.result;if("errorCode"in s){if("OK"!==s.errorCode)throw new t(this.id+" error returned: "+o)}}}}}};
//# sourceMappingURL=virwox.js.map