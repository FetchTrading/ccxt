"use strict";const[e,,t=null,r=null]=process.argv.filter(e=>!e.startsWith("--")),s=process.argv.includes("--verbose")||!1,a=process.argv.includes("--debug")||!1,i=(require("as-table"),require("util"),require("ololog")),n=(require("ansicolor").nice,require("fs")),o=require("../../ccxt.js"),c=(require("../../countries.js"),require("chai")),l=(c.expect,c.assert),h=i.bright.yellow.error;process.on("uncaughtException",e=>{i.bright.red.error(e),process.exit(1)}),process.on("unhandledRejection",e=>{i.bright.red.error(e),process.exit(1)}),i.bright("\nTESTING",{exchange:t,symbol:r||"all"},"\n");let u=["","https://cors-anywhere.herokuapp.com/"];const d=new o[t]({verbose:s,enableRateLimit:!0,debug:a,timeout:2e4}),f={};Object.keys(d.has).filter(e=>n.existsSync(__dirname+"/Exchange/test."+e+".js")).forEach(e=>{f[e]=require(__dirname+"/Exchange/test."+e+".js")});const g=require("../base/errors.js");Object.keys(g).filter(e=>n.existsSync(__dirname+"/errors/test."+e+".js")).forEach(e=>{f[e]=require(__dirname+"/errors/test."+e+".js")});let T=n.existsSync("keys.local.json")?"keys.local.json":"keys.json",y=require("../../"+T)[t];Object.assign(d,y),y&&y.skip&&(i.error.bright("[Skipped]",{exchange:t,symbol:r||"all"}),process.exit());let b=async(e,t)=>{"coinmarketcap"!==e.id&&(await f.fetchMarkets(e),await f.fetchCurrencies(e)),await f.fetchTicker(e,t),await f.fetchTickers(e,t),await f.fetchOHLCV(e,t),await f.fetchTrades(e,t),"coinmarketcap"===e.id?(i(await e.fetchTickers()),i(await e.fetchGlobal())):"coinbase"===e.id||(await f.fetchOrderBook(e,t),await f.fetchL2OrderBook(e,t),await f.fetchOrderBooks(e))},m=async e=>{await e.loadMarkets();l("object"==typeof e.markets,".markets is not an object"),l(Array.isArray(e.symbols),".symbols is not an array"),l(e.symbols.length>0,".symbols.length <= 0 (less than or equal to zero)"),l(Object.keys(e.markets).length>0,"Object.keys (.markets).length <= 0 (less than or equal to zero)"),l(e.symbols.length===Object.keys(e.markets).length,"number of .symbols is not equal to the number of .markets");let t=["BTC/CNY","BTC/USD","BTC/EUR","BTC/ETH","ETH/BTC","BTC/JPY","ETH/EUR","ETH/JPY","ETH/CNY","LTC/CNY","DASH/BTC","DOGE/BTC","BTC/AUD","BTC/PLN","USD/SLL","BTC/RUB","BTC/UAH","LTC/BTC"],r=e.symbols.filter(e=>t.indexOf(e)>=0);r.length>0&&(r=e.symbols.length>r.length?r.join(", ")+" + more...":r.join(", ")),i(e.symbols.length.toString().bright.green,"symbols",r)},C=async e=>{await m(e);e.rateLimit;let t=e.symbols[0],r=["BTC/USD","BTC/CNY","BTC/EUR","BTC/ETH","ETH/BTC","BTC/JPY","LTC/BTC","CVC/ETH","DAI/WETH"];for(let s in r)if(e.symbols.includes(r[s])){t=r[s];break}if("okex"===e.id&&(t="BTC/USDT"),i.green("SYMBOL:",t),t.indexOf(".d")<0&&await b(e,t),!e.apiKey||e.apiKey.length<1)return!0;e.checkRequiredCredentials(),e.urls.test&&(e.urls.api=e.urls.test);let s=await f.fetchBalance(e);await f.fetchFundingFees(e),await f.fetchTradingFees(e),await f.fetchOrders(e,t),await f.fetchOpenOrders(e,t),await f.fetchClosedOrders(e,t),await f.fetchMyTrades(e,t),e.extendedTest&&(await f.InvalidNonce(e,t),await f.OrderNotFound(e,t),await f.InvalidOrder(e,t),await f.InsufficientFunds(e,t,s))};!async function(){r?(await m(d),await b(d,r)):await async function(e,t){let r=0,s=t.length;y&&"proxy"in y&&(r=t.indexOf(y.proxy));for(let a=0;a<s;a++)try{e.proxy=t[r],e.proxy.length>0&&(e.origin=e.uuid()),await C(e);break}catch(e){if(r=++r%t.length,e instanceof o.DDoSProtection)h("[DDoS Protection]"+e.message.slice(0,200));else if(e instanceof o.RequestTimeout)h("[Request Timeout] "+e.message.slice(0,200));else{if(!(e instanceof o.ExchangeNotAvailable)){if(e instanceof o.AuthenticationError)return void h("[Authentication Error] "+e.message.slice(0,200));if(e instanceof o.InvalidNonce)return void h("[Invalid Nonce] "+e.message.slice(0,200));throw e}h("[Exchange Not Available] "+e.message.slice(0,200))}}}(d,u)}();
//# sourceMappingURL=test.js.map