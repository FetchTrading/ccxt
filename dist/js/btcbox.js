"use strict";const e=require("./base/Exchange"),{ExchangeError:t,InsufficientFunds:s,InvalidOrder:i,AuthenticationError:a,PermissionDenied:r,InvalidNonce:o,OrderNotFound:d,DDoSProtection:n}=require("./base/errors");module.exports=class extends e{describe(){return this.deepExtend(super.describe(),{id:"btcbox",name:"BtcBox",countries:"JP",rateLimit:1e3,version:"v1",has:{CORS:!1,fetchOrder:!0,fetchOrders:!0,fetchOpenOrders:!0,fetchTickers:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/31275803-4df755a8-aaa1-11e7-9abb-11ec2fad9f2d.jpg",api:"https://www.btcbox.co.jp/api",www:"https://www.btcbox.co.jp/",doc:"https://www.btcbox.co.jp/help/asm"},api:{public:{get:["depth","orders","ticker","allticker"]},private:{post:["balance","trade_add","trade_cancel","trade_list","trade_view","wallet"]}},markets:{"BTC/JPY":{id:"BTC/JPY",symbol:"BTC/JPY",base:"BTC",quote:"JPY"}},exceptions:{104:a,105:r,106:o,107:i,200:s,201:i,202:i,203:d,401:d,402:n}})}async fetchBalance(e={}){await this.loadMarkets();let t=await this.privatePostBalance(),s={info:t},i=Object.keys(this.currencies);for(let e=0;e<i.length;e++){let a=i[e],r=a.toLowerCase();"dash"===r&&(r="drk");let o=this.account(),d=r+"_balance",n=r+"_lock";d in t&&(o.free=parseFloat(t[d])),n in t&&(o.used=parseFloat(t[n])),o.total=this.sum(o.free,o.used),s[a]=o}return this.parseBalance(s)}async fetchOrderBook(e,t,s={}){await this.loadMarkets();let i=this.market(e),a={};this.symbols.length>1&&(a.coin=i.id);let r=await this.publicGetDepth(this.extend(a,s));return this.parseOrderBook(r)}parseTicker(e,t){let s=this.milliseconds(),i=void 0;t&&(i=t.symbol);let a=this.safeFloat(e,"last");return{symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeFloat(e,"high"),low:this.safeFloat(e,"low"),bid:this.safeFloat(e,"buy"),bidVolume:void 0,ask:this.safeFloat(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeFloat(e,"vol"),quoteVolume:this.safeFloat(e,"volume"),info:e}}async fetchTickers(e,t={}){await this.loadMarkets();let s=await this.publicGetAllticker(t),i=Object.keys(s),a={};for(let e=0;e<i.length;e++){let t=i[e],r=this.markets_by_id[t],o=r.symbol,d=s[t];a[o]=this.parseTicker(d,r)}return a}async fetchTicker(e,t={}){await this.loadMarkets();let s=this.market(e),i={};this.symbols.length>1&&(i.coin=s.id);let a=await this.publicGetTicker(this.extend(i,t));return this.parseTicker(a,s)}parseTrade(e,t){let s=1e3*parseInt(e.date);return{info:e,id:e.tid,order:void 0,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:void 0,side:e.type,price:e.price,amount:e.amount}}async fetchTrades(e,t,s,i={}){await this.loadMarkets();let a=this.market(e),r={};this.symbols.length>1&&(r.coin=a.id);let o=await this.publicGetOrders(this.extend(r,i));return this.parseTrades(o,a,t,s)}async createOrder(e,t,s,i,a,r={}){await this.loadMarkets();let o=this.market(e),d={amount:i,price:a,type:s};this.symbols.length>1&&(d.coin=o.id);let n=await this.privatePostTradeAdd(this.extend(d,r));return{info:n,id:n.id}}async cancelOrder(e,t,s={}){return await this.loadMarkets(),await this.privatePostTradeCancel(this.extend({id:e},s))}parseOrder(e){const t=this.safeString(e,"id"),s=this.parse8601(e.datetime+"+09:00"),i=this.safeFloat(e,"amount_original"),a=this.safeFloat(e,"amount_outstanding");let r=void 0;void 0!==i&&void 0!==a&&(r=i-a);const o=this.safeFloat(e,"price");let d=void 0;void 0!==o&&void 0!==r&&(d=r*o);const n={part:"open",all:"closed",cancelled:"canceled",closed:"closed"};let l=void 0;e.status in n&&(l=n[e.status]),void 0===l&&void 0!==a&&0===a&&(l="closed");return{id:t,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,amount:i,remaining:a,filled:r,side:e.type,type:void 0,status:l,symbol:"BTC/JPY",price:o,cost:d,trades:void 0,fee:void 0,info:e}}async fetchOrder(e,t,s={}){await this.loadMarkets();let i=await this.privatePostTradeView(this.extend({id:e},s));return this.parseOrder(i)}async fetchOrders(e,t,s,i={}){await this.loadMarkets();let a=await this.privatePostTradeList(this.extend({type:"all"},i));return this.parseOrders(a)}async fetchOpenOrders(e,t,s,i={}){await this.loadMarkets();let a=await this.privatePostTradeList(this.extend({type:"open"},i));const r=this.parseOrders(a);for(let e=0;e<r.length;e++){r[e].status="open"}return r}nonce(){return this.milliseconds()}sign(e,t="public",s="GET",i={},a,r){let o=this.urls.api+"/"+this.version+"/"+e;if("public"===t)Object.keys(i).length&&(o+="?"+this.urlencode(i));else{this.checkRequiredCredentials();let e=this.nonce().toString(),t=this.extend({key:this.apiKey,nonce:e},i),s=this.urlencode(t),o=this.hash(this.encode(this.secret));t.signature=this.hmac(this.encode(s),this.encode(o)),r=this.urlencode(t),a={"Content-Type":"application/x-www-form-urlencoded"}}return{url:o,method:s,body:r,headers:a}}handleErrors(e,s,i,a,r,o){if(e>=400)return;if("{"!==o[0])return;const d=JSON.parse(o),n=this.safeValue(d,"result");if(void 0===n||!0===n)return;const l=this.safeValue(d,"code"),h=this.id+" "+this.json(d),c=this.exceptions;if(l in c)throw new c[l](h);throw new t(h)}};
//# sourceMappingURL=btcbox.js.map